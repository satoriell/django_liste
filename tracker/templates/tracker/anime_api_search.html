{% extends 'tracker/base.html' %}
{% load static %}
{% comment %}
Konum: tracker/templates/tracker/anime_api_search.html
Jikan API kullanarak anime arama sonuçlarını gösterir.
Listede olan öğeler için farklı buton/rozet gösterimi.
AOS animasyonları eklendi.
{% endcomment %}

{% block title %}{{ search_title|default:"API ile Anime Ara" }} - Kişisel Liste{% endblock title %}

{% block content %}
    {# Başlık (AOS) #}
    <h1 class="mb-4 text-primary" data-aos="fade-down"><i class="fas fa-search me-2"></i>{{ search_title|default:"Jikan API ile Anime Ara" }}</h1>

    {# Arama Formu (AOS) #}
    <div class="controls-container p-3 mb-4 border rounded shadow-sm" data-aos="fade-up">
        <form method="post" action="{% url 'tracker:anime_api_search' %}">
            {% csrf_token %}
            <div class="input-group">
                <input type="search" class="form-control" name="query" placeholder="{{ item_type_name|default:'Anime' }} başlığı girin..." value="{{ query|default:'' }}" aria-label="{{ item_type_name|default:'Anime' }} başlığı" required>
                <button class="btn btn-primary" type="submit"><i class="fas fa-search me-1"></i>Ara</button>
            </div>
        </form>
    </div>

    {# Arama Sonuçları #}
    {% if search_results is not None %} {# Sadece arama yapıldıysa göster #}
        <hr data-aos="fade">
        <h4 class="mb-3" data-aos="fade-up">Arama Sonuçları {% if query %}({{ query|truncatechars:30 }}){% endif %}</h4>

        {% if search_results %}
            {# Sonuçları kartlar halinde gösteren satır #}
            <div class="row row-cols-1 row-cols-sm-2 row-cols-md-3 row-cols-lg-4 g-4">
                {% for result in search_results %}
                    {# Her kart için sütun (AOS) #}
                    <div class="col d-flex align-items-stretch" data-aos="fade-up" data-aos-delay="{% cycle 0 50 100 150 %}">
                        <div class="card h-100 shadow-sm favorite-card"> {# favorite-card sınıfı eklendi #}
                             {# Resim Alanı #}
                             <div class="fixed-height-image-container"> {# CSS ile yükseklik ayarlı #}
                                {% if result.image_url %}
                                    <img src="{{ result.image_url }}" class="favorite-card-img" alt="{{ result.title }} Kapak">
                                {% else %}
                                    <div class="d-flex align-items-center justify-content-center h-100 bg-light">
                                        <i class="fas fa-image fa-3x text-secondary"></i>
                                    </div>
                                {% endif %}
                            </div>
                            {# Kart İçeriği #}
                            <div class="card-body d-flex flex-column p-3">
                                {# Başlık (Satır sınırlı) #}
                                <div class="favorite-card-title-container mb-2 flex-grow-1">
                                    <h6 class="card-title favorite-card-title" title="{{ result.title }}">
                                        {{ result.title }} {% if result.type %}<small class="text-muted fw-normal">({{ result.type }})</small>{% endif %}
                                    </h6>
                                </div>
                                {# Diğer Bilgiler #}
                                <small class="text-muted mb-2 d-block">
                                    {% if result.episodes %}Bölüm: {{ result.episodes }} | {% endif %}
                                    {% if result.score %}Puan: {{ result.score }}/10 | {% endif %}
                                    {% if result.status %}Durum: {{ result.status }}{% endif %}
                                </small>
                                {# Açıklama (Kısaltılmış) #}
                                {% if result.synopsis_snippet %}<p class="card-text small text-muted mb-2" style="line-height: 1.3;"><i>{{ result.synopsis_snippet }}</i></p>{% endif %}

                                {# Ekleme Butonu / Listede Rozeti (En altta) #}
                                <div class="mt-auto w-100 pt-2">
                                     {% if result.mal_id in existing_ids_in_db %}
                                        {# Listede var rozeti #}
                                        <span class="badge bg-success text-white w-100 py-2 rounded-pill" style="font-size: 0.85rem;">
                                            <i class="fas fa-check-circle me-1"></i> Listede Mevcut
                                        </span>
                                    {% else %}
                                         {# Listeye ekle butonu #}
                                        <a href="{% url add_item_url_name result.mal_id %}" class="btn btn-sm btn-success w-100">
                                            <i class="fas fa-plus me-1"></i> Listeme Ekle
                                        </a>
                                    {% endif %}
                                </div>
                            </div>
                            {# Kart Footer (MAL ID) #}
                            <div class="card-footer text-muted small py-1 px-3">MAL ID: {{ result.mal_id }}</div>
                        </div>
                    </div>
                {% endfor %}
            </div>
         {% elif query %} {# Arama yapıldı ama sonuç yoksa #}
            <div class="alert alert-warning" role="alert" data-aos="fade-in">"{{ query }}" için Jikan (MAL) üzerinde sonuç bulunamadı.</div>
        {% endif %} {# if search_results #}

    {% endif %} {# search_results is not None kontrolü sonu #}
{% endblock content %}
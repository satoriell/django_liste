{% extends 'tracker/base.html' %}
{% load static %}
{% comment %} Konum: /home/admin/App/django_liste/tracker/templates/tracker/favorites.html {% endcomment %}

{% block title %}Favorilerim - Kişisel Liste{% endblock title %}

{% block content %}

    <h1 class="mb-4"><i class="fas fa-heart text-danger me-2"></i>Favorilerim ({{ total_favorites }})</h1>

    {% if grouped_favorites_list %}
        {# Favori öğeleri türe göre gruplandırarak göster #}
        {% for item_type_key, items_list in grouped_favorites_list %}
            {# Her tür için bir başlık (Türkçeleştirilmiş) #}
            {# DÜZELTME: Gereksiz 'replace' filtreleri kaldırıldı #}
            {% with item_type_name=item_type_key|capfirst %}
                <h3 class="mb-3 mt-4">
                    {# Türe göre ikon ve renk #}
                    {% if item_type_key == 'anime' %}<i class="fas fa-tv text-primary me-2"></i>Anime
                    {% elif item_type_key == 'webtoon' %}<i class="fas fa-scroll text-success me-2"></i>Webtoon
                    {% elif item_type_key == 'manga' %}<i class="fas fa-book-open text-danger me-2"></i>Manga
                    {% elif item_type_key == 'novel' %}<i class="fas fa-book me-2" style="color: #6f42c1;"></i>Novel
                    {% else %}{{ item_type_name }}
                    {% endif %}
                    <span class="badge bg-secondary ms-2">{{ items_list|length }}</span>
                </h3>
            {% endwith %}

            {# O türe ait favori öğeler listesi #}
            <ul class="list-group shadow-sm mb-4">
                {% for item in items_list %}
                    {# _list_item partial'ını çağırırken doğru context'i sağla #}
                    {% with detail_url_name=item_type_key|add:'_detail' edit_url_name=item_type_key|add:'_edit' delete_url_name=item_type_key|add:'_delete' %}
                    {# favorited_pks set'ini oluştur (bu sayfada hepsi favori olduğu için hepsini içerir) #}
                    {# DİKKAT: favorited_pks'in bir set veya liste olması beklenir, string değil. View'dan doğru geldiğini varsayıyoruz. #}
                    {% include 'tracker/partials/_list_item.html' with item=item detail_url_name=detail_url_name edit_url_name=edit_url_name delete_url_name=delete_url_name item_type=item_type_key favorited_pks=favorited_pks %}
                    {% endwith %}
                {% empty %}
                    {# Bu aslında olmamalı çünkü grouped_favorites_list boşsa buraya gelinmez, ama güvenlik için #}
                    <li class="list-group-item text-muted">Bu türde favori öğe bulunamadı.</li>
                {% endfor %}
            </ul>
        {% endfor %}

    {% else %}
        {# Hiç favori yoksa mesaj göster #}
        <div class="alert alert-info mt-4" role="alert">
            <i class="fas fa-info-circle me-2"></i> Henüz favorilerinize eklediğiniz bir öğe bulunmuyor. Listelerdeki <i class="fas fa-star"></i> ikonuna tıklayarak favorilerinize ekleyebilirsiniz.
        </div>
    {% endif %}

{% endblock content %}